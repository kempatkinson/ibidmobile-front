<template>
    <div class="countdown-wrapper">
       <span class="darkgrey">
          <b v-if="current === 0" v-bind:class="{'countdown-active':active,'countdown-disabled':!active}" class="getcode" @click="plan" v-text="normalText"></b>
          <b v-else class="waitcode">{{waitingText}} ({{current}})s</b>
        </span>
    </div>
</template>
<style scoped>
    .darkgrey{
        position: absolute;
        right: 0px;
        display: inline-block;
        width:110px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        margin:14px 0px;
    }
    .darkgrey:before{
        content: '';
        position: absolute;
        width: 1px;
        height: 200%;
        top:0;
        left:0;
        border-left: 1px solid #d6e4ed;
        -webkit-transform-origin: 0 0;
        transform-origin: 0 0;
        -webkit-transform: scale(0.5, 0.5);
        transform: scale(0.5, 0.5);
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
    }
    b{
        font-weight: normal;
    }
    .getcode {
        display: inline-block;
        line-height: inherit;
    }
    .waitcode{
        color:#94a3ae;

    }
</style>
<style>
    .countdown-wrapper .countdown-active{
        color: #2b92e0;
    }
    .countdown-wrapper .countdown-disabled{
        color: #94a3ae;
    }
</style>
<script>
    export default{
        props:{
            time:{      //倒计时总时间
                type:Number,
                default:60
            },
            normalText:{        //常规状态下文字
                type:String,
                default:"获取验证码"
            },
            waitingText:{       //倒计时等待时提示文字
                type:String,
                default:"重新获取"
            },
            active:{            //按钮是否可用
                type:Boolean,
                default:false
            }
        },
        data(){
            return{
                current:0
            }
        },
        methods:{
            "plan":function(){          //用户准备开始倒计时,向父级派发事件
                this.$dispatch("plan");
            },
            reduceOne: function() {
                this.current--;
                if(this.current > 0) {
                    setTimeout(this.reduceOne.bind(this), 1000);
                }
            }
        },
        events:{
            "ready":function(){     //开始倒计时,由外部派发
                this.current=this.time;
                this.reduceOne();
            }
        }

    }
</script>
